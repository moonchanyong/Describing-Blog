---
layout: post
title: sitemesh 데코레이터가 안 붙는이슈
category: [ troubleshooting ]
tags: [ troubleshooting, sitemesh, decorator, freemarker ]
---

# 데코레이터가 갑자기 안 붙는이슈

> 2019년에 sitemesh?? 나도 안다. ㅇㅇ .. ㄹㄱㅅ ㅇㅈ

## CONTEXT

1. DB 데이터를 조회하는 뷰에서 특정 컬럼을 넣으면 뷰가 꺠지는 현상 발생
2. console을 통해 보았더니 JS 라이브러리가 import가 안되고, head에 script태그가 안들어가 있다.
3. decorator를 통해서 헤드에 임포트 할 라이브러리를 넣어주는데 특정 데이터의 컬럼을 임포트하면 데코레이터가 동작을 안한다


## 접근 💫

### FRONT 에서 BACK 방향으로 접근

1. network 탭 확인
```
  네트워크 탭에서 리퀘스트에서 뷰가 꺠지는 경우와 안 깨지는 경우 달라진 점이 있나 확인 =>
    특정 정려 관련 파라미터의 유무 확인 하여 추가해봄 => 동작 =>
      정렬관련 디폴트로 추가하려고 처리 중 스멜을 캐치 =>
        정렬은 데이터의 출력 순서만 바뀌는데 이게 이슈가 있을까?? =>
          그 생각대로 뷰가 로딩되는 첫 페이지가 아닌 다른페이지에서 같은현상 발생
```

2. decorator 기능을 제공하는 sitemesh 확인
```
  데코레이터를 붙이는 동작을 하는경우 이상이 있을 것 같아서 sitemesh 라이브러리 내에서 브레이크 포인트 몇개 놓고 어떤 데코레이터를 사용하는지 판별하는지 확인 =>
    request URL패턴으로 지정하여 같은 URL인 경우 동작해야하는데 path mapper에서 지정한 데코레이터의 해쉬맵에 문제 상황에서는 없다. (문제 상황과 정상적인 상황에서 다른 Path Mapper instance를 참조) =>
      어째서 위와 같이 다른 객체를 참조하여 처리하는지 원인을 찾아야함 =>
        나는 게으르기 때문에 방향을 바꿈
```

### BACK에서 FRONT로 접근

3. 문제가 되는 데이터를 찾아보자
```
  페이지들의 데이터를 각자 요청을 해보았는데 특정 데이터만 문제가 발생 =>
    해당 데이터의 값중에 문제가 될 만한 값이나 다른 데이터에는 없는 값을 확인  =>
      <Frame blah blah> 라는 문자열을 발견... =>
       해당 문자열을 지우니 동작
```

### 🌚 원인

```
sitemesh에서는 여러 데코레이터 매퍼가 존재하는데 <FRAME *>이라는 패턴이 발견이 되면 frame기반 데코레이터 매퍼를 사용(전시회이름인데 하필 전시회이름과 전시회 이름 표기법이 맞아떨어짐;)
```

![decorator mapper](/Describing-Blog/assets/img/troubleshooting/sitemesh_mapper.png);

### 해결 🌝
```
해결은 각 컨텍스트마다 최적의 해법이 다르기 떄문에 적을 필요 없을듯
```

## 수고링 ✈ ️