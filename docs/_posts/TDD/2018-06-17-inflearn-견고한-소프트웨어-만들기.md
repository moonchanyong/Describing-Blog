---
layout: post
title: 인프런 견고한 소프트웨어 만들기(TDD)
category: [ TDD ]
tags: [ TDD, TestDrivenDevelop ]
---


# TDD를 공부하자

## 몇 가지 테스트 개념들
두가지 개념

### 유닛 테스트(unit test)

* 특정 조건에서 어떻게 작동해야 할지 정의한 것
* 단위테스트의 단위는 함수를 뜻함(보통 상황인듯)

준비(arrange) - 실행(act) - 단언(assert) 패턴을 따른다

### TDD 순서

적색단계(처음 일부러 실패하는) - 녹색단계(테스트 실행) - 파랑단계(Refactor, 코드의 질을 높인다.)순환

#### 리팩터

* 기존의 로직을 유지하면서 순환해야한다.
* 테스트 코드의 실행 여부에따라 로직을 확인한다.

//TODO: 환경만들기

### 기본 jasmine 테스트 골격

#### Test Suite
* describe('테스트 설명', 테스트 구현 함수)

#### Test Spec

* it('테스트 설명', 기대식을 가진 테스트 구현 함수)

#### 기대식과 매쳐

* expect(결과 값).toBe(기대하는 값)

#### 스파이

* spyOn(감시할 객체, 감시할 메소드)


## 테스트 할 수 없는 코드1

### 예시코드
```html
<button onclick="counter++; countDisplay()">증가</button>
<span id="counter-display">0</span>

<script>
  var counter = 0;
  function countDisplay() {
    var el = document.getElementById('counter-display');
    el.innerHTML = counter;
  }
</script>
```

### 코드의 문제

1. 관심사가 분리되지 않았다.

<button onclick="counter++; countDisplay()">증가</button>

* 클릭 이벤트 처리기를 인라인 형태로 정의한점

* 단일책임의 원칙(oop)처럼 여기도 적용(증가와 업데이트가 두개로 나누어져 있다)

2. 재사용성이 떨어짐

var counter = 0;

* 전역 공간을 어지럽힌다.

var el = document.getElementById('counter-display');

* 횟수를 표시하는 span id를 displayCount 함수에서 하드코딩한 점

* 확장이 안좋다.

### 코드 개선

1. 코드를 UI에서 완전히 분리

HTML에서 JS 코드를 떼어내면 비즈니스 로직만 테스트할 수 있다.

2. 자바스크립트를 별도 파일로 분리

다른 곳에서도 재사용 할 수 있고 테스트성도 좋아진다.

## 모듈패턴

* TDD 전 베이스 지식

* 모듈패턴이란 함수로 데이터를 감추고, 모듈 API를 담고 있는 객체를 반환하는 형태(RORO ?)

### 임의 함수를 호출하여 생성하는 모듈


```javascript
// 네임스페이스 선언
var App = App || {}

// 네임스페이스에 함수를 추가, 의존성있는 God함수를 주입(dependency injection)
App.Person = function (God) {
  var name = God.makeName()

  // API를 노출한다
  Return {
    getName: function() { return name },
    setName: function(newName) { name = new Name }
  }
}

const person = App.Person(God);
person.getName();
```

### 즉시실행함수(IIFE) 기반의 모듈

```javascript

var App = App|| {}

App.Person = (function () {
  let name = "";

  return {
    getName(God){
      name = name || God.makeName();
      return name;
    },
    setName(newName) { name = newName; }
  }
})() //함수 선언 즉시 실행한다. (실글톤)
```

### 모듈패턴의 원칙

테스트하기 쉽게 하려고

1. 단일 책임 원칙에 따라서 한가지 역할만 한다
* 그 역할만 집중하여 모듈을 더욱 튼튼하게 만든다


2. 모듈 자신이 사용할 객체가 있다면 DI형태로 제공한다.
* 팩토리 주입 형태로 제공한다
